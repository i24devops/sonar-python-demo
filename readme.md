
# SonarQube Demo with Python — End-to-End Steps


##  *What is a Sonar Scanner?*

`Sonar Scanner` is a *command-line tool* that sends your project’s source code to *SonarQube* for analysis.

Think of it like this:

### Your Code → Sonar Scanner → SonarQube Dashboard

It reads your files, checks them, and uploads the results.

---

### SonarQube vs Sonar Scanner

| Tool              | What it Does                                                                                  |
| ----------------- | --------------------------------------------------------------------------------------------- |
| **SonarQube**     | The **server** that analyzes, stores results, shows dashboard, issues, bugs, smells, coverage |
| **Sonar Scanner** | The **tool that sends your code** to the SonarQube server so it can analyze                   |

---
## 0) Preconditions

* SonarQube is running and reachable at `http://SONARQUBE_PUBLIC_IP:9000`.
* You’ve created a `Global Analysis Token` in SonarQube:
  **Top-Right → My Account → Security → Generate Token** (save it safely).

> We’ll use this token via `-Dsonar.login=<TOKEN>` when scanning.

## 1) Install SonarScanner CLI (Linux)

```bash
cd /opt

wget https://binaries.sonarsource.com/Distribution/sonar-scanner-cli/sonar-scanner-cli-7.3.0.5189-linux-x64.zip

apt install -y unzip
unzip sonar-scanner-cli-7.3.0.5189-linux-x64.zip

mv sonar-scanner-7.3.0.5189-linux-x64 sonar-scanner

echo 'export PATH=$PATH:/opt/sonar-scanner/bin' >> /etc/profile
source /etc/profile

sonar-scanner --version
```

You should see a version banner confirming the scanner is on your `PATH`.

---

## 2) Prepare Python environment (venv + test deps)

From your **project root**:

```bash
cd /opt/sonar-python-demo

apt install -y python3.10-venv
python3 -m venv .venv
source .venv/bin/activate

apt install -y python3-pip
pip install -U pip
pip install pytest pytest-cov
```

---

## 3) Ensure Python package import works

Mark `app/` as a package and run tests with coverage:

```bash
# still in /opt/sonar-python-demo
pwd
# -> /opt/sonar-python-demo

# make app a package
touch app/__init__.py

# run tests and produce coverage.xml
PYTHONPATH="$PWD" pytest -q --cov=app --cov-report=xml
```

Expected:

* Tests run successfully
* A file `coverage.xml` appears in the project root

> If imports fail again, double-check you’re running from `/opt/sonar-python-demo` and that `app/__init__.py` exists.

---

## 4) Configure Sonar project (properties file)

If you haven’t already, create **`sonar-project.properties`** in the project root with:

```properties
sonar.projectKey=python-demo
sonar.projectName=Python SonarQube Demo
sonar.projectVersion=1.0

# Sources & tests
sonar.sources=app,main.py
sonar.tests=tests

# Python
sonar.language=py
sonar.python.version=3.10

# Coverage (generated by pytest-cov)
sonar.python.coverage.reportPaths=coverage.xml

# Housekeeping
sonar.exclusions=**/.venv/**,**/__pycache__/**
sonar.cpd.exclusions=tests/**
```

---

## 5) Run the Sonar scan

Use your **user token** (created in step 0):

```bash
sonar-scanner \
  -Dsonar.host.url=http://SONARQUBE_PUBLIC_IP:9000 \
  -Dsonar.login=<PASTE_YOUR_TOKEN_HERE>
```

> **Note:** Use `-Dsonar.login` (for SonarQube server).
> `-Dsonar.token` is for SonarCloud.

---

## 6) View results

Open SonarQube: `http://SONARQUBE_PUBLIC_IP:9000`
Navigate to your project (e.g., **Python SonarQube Demo**).
Explore:

* **Issues** (Bugs, Code Smells)
* **Security Hotspots**
* **Duplications**
* **Coverage** (from `coverage.xml`)

---

## Recap (commands as one sequence)

```bash
# ——— Scanner install ———
cd /opt
wget https://binaries.sonarsource.com/Distribution/sonar-scanner-cli/sonar-scanner-cli-7.3.0.5189-linux-x64.zip
apt install -y unzip
unzip sonar-scanner-cli-7.3.0.5189-linux-x64.zip
mv sonar-scanner-7.3.0.5189-linux-x64 sonar-scanner
echo 'export PATH=$PATH:/opt/sonar-scanner/bin' >> /etc/profile
source /etc/profile
sonar-scanner --version

# ——— Python env ———
cd /opt/sonar-python-demo
apt install -y python3.10-venv
python3 -m venv .venv
source .venv/bin/activate
apt install -y python3-pip
pip install -U pip
pip install pytest pytest-cov

# ——— Tests + coverage ———
touch app/__init__.py
PYTHONPATH="$PWD" pytest -q --cov=app --cov-report=xml

# ——— Sonar scan ———
sonar-scanner -Dsonar.host.url=http://SONARQUBE_PUBLIC_IP:9000 -Dsonar.login=<YOUR_TOKEN>
```